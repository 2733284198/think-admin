sudo: true

language: php

php:
  - 7.1.9
  
cache:
  directories:
    - vendor
    - $HOME/.composer/cache
  
before_install:
  - composer self-update
  - openssl aes-256-cbc -K $encrypted_70c23fbfe7fe_key -iv $encrypted_70c23fbfe7fe_iv -in deployer.enc -out $HOME/.ssh/id_rsa -d
  - chmod 600 $HOME/.ssh/id_rsa
  - eval `ssh-agent`
  - ssh-add -k $HOME/.ssh/id_rsa
  - ssh-add
  - ssh-add -l
  
script:
  - composer install
  
after_script:
  - cat ./deployer
  - rsync -r /home/travis/build/xiaodit/think-admin/* -e "ssh -o StrictHostKeyChecking=no -p ${XDPORT} -i ./deployer" ${XDUSER}@${XDHOST}:${XDPATH}
